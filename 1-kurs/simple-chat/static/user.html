<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="logo">Simple Chat</div>
            <div class="muted small" id="username-label">Profile</div>
        </div>

        <div class="form-grid">
            <h2 id="full-name">Loading...</h2>
            <p class="muted" id="username"></p>
            <p class="small" id="created"></p>
            <div id="bio" class="small" style="white-space: pre-wrap;"></div>

            <div class="row" style="justify-content: space-between;">
                <a class="small" href="/home">Back to chat</a>
                <a class="small" href="/profile">Edit my profile</a>
            </div>
            <div id="error" class="notice" style="display:none"></div>
        </div>
    </div>

    <script>
        const parts = window.location.pathname.split('/');
        const username = parts[parts.length - 1];
        const errorEl = document.getElementById('error');

        async function loadUser() {
            try {
                const res = await fetch(`/users/${encodeURIComponent(username)}`, { credentials: 'include' });
                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    throw new Error(err.detail || 'User not found');
                }
                const data = await res.json();
                document.getElementById('username-label').textContent = `@${data.username}`;
                document.getElementById('username').textContent = `@${data.username}`;
                const name = data.first_name || data.last_name ? `${data.first_name || ''} ${data.last_name || ''}`.trim() : data.username;
                document.getElementById('full-name').textContent = name || data.username;
                document.getElementById('bio').textContent = data.bio || 'No bio yet.';
                if (data.created_at) {
                    document.getElementById('created').textContent = `Joined ${new Date(data.created_at).toLocaleDateString()}`;
                }
            } catch (err) {
                errorEl.textContent = err.message || 'Failed to load user';
                errorEl.style.display = 'block';
            }
        }

        loadUser();
    </script>
</body>

</html>